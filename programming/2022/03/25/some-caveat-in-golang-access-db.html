<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Some caveats in Golang when accessing Database | Hao Chun Chang’s Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Some caveats in Golang when accessing Database" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In Postgres numeric column data type, Golang sql package will return string([]uint8) type. Therefore I used strconv.ParseFloat to parse it into float. Golang struct has default zero values (e.g. int will defaults to 0) for each field if you didn’t specify it. This means that: If we insert the value into the db, the db will record the value as 0. But if we skip the value if it is 0, then db will record it as NULL and will be recognized as nil . (If we skip 0, then db simply ignore the value 0 which may not be the case we want) To check if the data exists before insertion, we can use pointer field so that we can check if the pointer is nil. It doesn’t affect json unmarshal since Golang automatically handle the pointer to point to the object and decode the json." />
<meta property="og:description" content="In Postgres numeric column data type, Golang sql package will return string([]uint8) type. Therefore I used strconv.ParseFloat to parse it into float. Golang struct has default zero values (e.g. int will defaults to 0) for each field if you didn’t specify it. This means that: If we insert the value into the db, the db will record the value as 0. But if we skip the value if it is 0, then db will record it as NULL and will be recognized as nil . (If we skip 0, then db simply ignore the value 0 which may not be the case we want) To check if the data exists before insertion, we can use pointer field so that we can check if the pointer is nil. It doesn’t affect json unmarshal since Golang automatically handle the pointer to point to the object and decode the json." />
<link rel="canonical" href="https://haochunchang.github.io/programming/2022/03/25/some-caveat-in-golang-access-db.html" />
<meta property="og:url" content="https://haochunchang.github.io/programming/2022/03/25/some-caveat-in-golang-access-db.html" />
<meta property="og:site_name" content="Hao Chun Chang’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-25T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"In Postgres numeric column data type, Golang sql package will return string([]uint8) type. Therefore I used strconv.ParseFloat to parse it into float. Golang struct has default zero values (e.g. int will defaults to 0) for each field if you didn’t specify it. This means that: If we insert the value into the db, the db will record the value as 0. But if we skip the value if it is 0, then db will record it as NULL and will be recognized as nil . (If we skip 0, then db simply ignore the value 0 which may not be the case we want) To check if the data exists before insertion, we can use pointer field so that we can check if the pointer is nil. It doesn’t affect json unmarshal since Golang automatically handle the pointer to point to the object and decode the json.","mainEntityOfPage":{"@type":"WebPage","@id":"https://haochunchang.github.io/programming/2022/03/25/some-caveat-in-golang-access-db.html"},"url":"https://haochunchang.github.io/programming/2022/03/25/some-caveat-in-golang-access-db.html","@type":"BlogPosting","headline":"Some caveats in Golang when accessing Database","dateModified":"2022-03-25T00:00:00+00:00","datePublished":"2022-03-25T00:00:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">

  <!-- favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/images/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/images/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- for mathjax support -->
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <link type="application/atom+xml" rel="alternate" href="https://haochunchang.github.io/feed.xml" title="Hao Chun Chang's Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Hao Chun Chang&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/daily_posts.html">Daily</a><a class="page-link" href="/blog/deep_learning_posts.html">Deep-Learning</a><a class="page-link" href="/blog/programming_posts.html">Programming</a><a class="page-link" href="/blog/tools_posts.html">Tools</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Some caveats in Golang when accessing Database</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-03-25T00:00:00+00:00" itemprop="datePublished">Mar 25, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul>
  <li>In Postgres <code class="language-plaintext highlighter-rouge">numeric</code> column data type, Golang <code class="language-plaintext highlighter-rouge">sql</code> package will return <code class="language-plaintext highlighter-rouge">string([]uint8)</code> type. Therefore I used <code class="language-plaintext highlighter-rouge">strconv.ParseFloat</code> to parse it into float.</li>
  <li>Golang struct has default zero values (e.g. int will defaults to 0) for each field if you didn’t specify it.
    <ul>
      <li>This means that:
        <ul>
          <li>If we insert the value into the db, the db will record the value as 0.</li>
          <li>But if we skip the value if it is 0, then db will record it as <code class="language-plaintext highlighter-rouge">NULL</code> and will be recognized as <code class="language-plaintext highlighter-rouge">nil</code> . (If we skip 0, then db simply ignore the value 0 which may not be the case we want)</li>
        </ul>
      </li>
      <li>To check if the data exists before insertion, we can use pointer field so that we can check if the pointer is <code class="language-plaintext highlighter-rouge">nil</code>.
        <ul>
          <li>It doesn’t affect json unmarshal since Golang automatically handle the pointer to point to the object and decode the json.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="conclusion">Conclusion</h3>

<p>Need to decide what behavior should be when dealing with empty input data.</p>

<p>This time I decided to skip insertion if underlying data are “all empty”, but inserting default zero values if partial data is missing.</p>

<p>One can also skip inserting missing value in partial data, but that needs to utilize pointer field for each one you want to skip.</p>

  </div><a class="u-url" href="/programming/2022/03/25/some-caveat-in-golang-access-db.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Hao Chun Chang&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p>This is a blog post about a software engineer started from biochemistry to medical artifical intelligence.</p>
      </div>

      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            Contact Me
          </li><li><a class="u-email" href="mailto:changhaochun84@gmail.com">changhaochun84@gmail.com</a></li></ul>
      </div>


      <div class="footer-col footer-col-3"><ul class="social-media-list"><li><a href="https://github.com/haochunchang"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">haochunchang</span></a></li><li><a href="https://www.linkedin.com/in/haochunchang84"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">haochunchang84</span></a></li></ul>
</div>

    </div>

  </div>

</footer>
</body>

</html>
